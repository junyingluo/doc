### ClassDeclaration

- 生成 TsType

```c++
checker::Type *ETSAnalyzer::Check(ir::ClassDeclaration *st) const
{
  ETSChecker *checker = GetETSChecker();
  st->Definition()->Check(checker);
  return ReturnTypeForStatement(st);
}

checker::Type *ETSAnalyzer::Check(ir::ClassDefinition *node) const
{
    ETSChecker *checker = GetETSChecker();

    if (node->TsType() == nullptr) {
        checker->BuildBasicClassProperties(node);
    }

    if (!node->IsClassDefinitionChecked()) {
        checker->CheckClassDefinition(node);
    }

    return node->TsType();
}

Type *ETSChecker::BuildBasicClassProperties(ir::ClassDefinition *classDef)
{
    auto *var = classDef->Ident()->Variable();

    checker::ETSObjectType *classType {};
    if (var->TsType() == nullptr) {
        classType = CreateETSObjectTypeOrBuiltin(classDef, checker::ETSObjectFlags::CLASS);
        classType->SetVariable(var);
        var->SetTsType(classType);
        if (classDef->IsAbstract()) {
            classType->AddObjectFlag(checker::ETSObjectFlags::ABSTRACT);
        }
    } else {
        classType = var->TsType()->AsETSObjectType();
    }

    classDef->SetTsType(classType);

    ConstraintCheckScope ctScope(this);
    if (classDef->TypeParams() != nullptr) {
        classType->AddTypeFlag(TypeFlag::GENERIC);
        CreateTypeForClassOrInterfaceTypeParameters(classType);
    }

    auto *enclosingClass = Context().ContainingClass();
    classType->SetEnclosingType(enclosingClass);
    CheckerStatus newStatus = CheckerStatus::IN_CLASS;

    if (classDef->IsInner()) {
        newStatus |= CheckerStatus::INNER_CLASS;
        classType->AddObjectFlag(checker::ETSObjectFlags::INNER);
    }

    auto savedContext = checker::SavedCheckerContext(this, newStatus, classType);

    if (!classType->HasObjectFlag(ETSObjectFlags::RESOLVED_SUPER)) {
        GetSuperType(classType);
        GetInterfaces(classType);
    }
    ctScope.TryCheckConstraints();
    return classType;
}
```

### CheckClassDefinition

- 语义检查

```c++
void ETSChecker::CheckClassDefinition(ir::ClassDefinition *classDef)
{
    classDef->SetClassDefinitionChecked();

    if (classDef->TsType() == nullptr) {
        ES2PANDA_ASSERT(IsAnyError());
        classDef->SetTsType(GlobalTypeError());
    }

    if (classDef->TsType()->IsTypeError()) {
        return;
    }

    auto *classType = classDef->TsType()->AsETSObjectType();
    if (classType->SuperType() != nullptr) {
        classType->SuperType()->GetDeclNode()->Check(this);
    }

    auto newStatus = checker::CheckerStatus::IN_CLASS;
    if (Context().ContainingClass() != classType) {
        classType->SetEnclosingType(Context().ContainingClass());
    }

    if (classDef->IsInner()) {
        newStatus |= CheckerStatus::INNER_CLASS;
        classType->AddObjectFlag(checker::ETSObjectFlags::INNER);
    }

    classDef->IsModule() ? classType->AddObjectFlag(checker::ETSObjectFlags::GLOBAL)
                         : CheckLocalClass(classDef, newStatus);

    checker::ScopeContext scopeCtx(this, classDef->Scope());
    auto savedContext = SavedCheckerContext(this, newStatus, classType);

    ResolveDeclaredMembersOfObject(classType);

    if (classDef->IsAbstract()) {
        AddStatus(checker::CheckerStatus::IN_ABSTRACT);
        classType->AddObjectFlag(checker::ETSObjectFlags::ABSTRACT);
    }

    if (classDef->IsStatic() && !Context().ContainingClass()->HasObjectFlag(ETSObjectFlags::GLOBAL)) {
        AddStatus(checker::CheckerStatus::IN_STATIC_CONTEXT);
    }

    if ((static_cast<ir::AstNode *>(classDef)->Modifiers() & ir::ModifierFlags::FUNCTIONAL) == 0) {
        ValidateOverriding(classType, classDef->Start());
    }

    TransformProperties(classType);
    CheckClassElement(classDef);

    if (classDef->IsGlobal() || classType->SuperType() == nullptr) {
        return;
    }

    CheckClassAnnotations(classDef);
    CheckConstructors(classDef, classType);
    CheckValidInheritance(classType, classDef);
    CheckConstFields(classType);
    CheckGetterSetterProperties(classType);
    CheckInvokeMethodsLegitimacy(classType);
    CheckTypeParameterVariance(classDef);
}
```
