### makefile

- make ：执行第一个任务
- make clean：执行 clean 任务

```
cc = gcc
prom = test
obj = test.o
CFLAGS = -static

$(prom): $(obj)
	    $(cc) -o $(prom) $(obj) $(CFLAGS)

%.o: %.c
	    $(cc) -c $< -o $@

clean:
	    rm -rf $(obj) $(prom)
```

### gcc

- -c 表示只编译不链接
- -E 表示只进行预处理
- -S 表示只进行汇编

* arm gcc
  - arm32 : arm-linux-gnu-gcc
  - arm64 : aarch64-linux-gnu-gcc

### gcc 扩展语法

- typeof 获取变量类型

```c
#define max(a, b) ({\
		typeof(a) _a = a;\
		typeof(b) _b = b;\
		_a > _b ? _a : _b; })
```

- 零长数组

```c
struct c {
  int num;
  char body[0];
}
```

- case 范围

```c
switch (i) {
  case 0 ... 1:
  	break;
  case 'a' ... 'z':
  	break;
}
```

- 标号元素

```c
static const struct file_operations acpi_battery_alarm_fops = {
	.owner		= THIS_MODULE,
	.open		= acpi_battery_alarm_proc_open,
	.read		= seq_read,
	.write		= acpi_battery_write_alarm,
	.llseek		= seq_lseek,
	.release	= single_release,
};
```

- 可变参数宏 \_\_VA_ARGS\_\_

```c
#define kenter(FMT, ...) \
	pr_devel("==> %s("FMT")\n", __func__, ##__VA_ARGS__)
```

- 函数属性 \_\_attribute\_\_

```c
static void __attribute__((noreturn)) fail_file(void)
{
	cleanup();
	longjmp(jmpenv, SJ_FAIL);
}
```

- 字节对齐

```c
struct megasas_aen {
	u16 host_no;
	u16 __pad1;
	u32 seq_num;
	u32 class_locale_word;
} __attribute__ ((packed));

struct ibmvfc_fcp_rsp {
	__be64 reserved;
	__be16 retry_delay_timer;
	u8 flags;
	u8 scsi_status;
	__be32 fcp_resid;
	__be32 fcp_sense_len;
	__be32 fcp_rsp_len;
	union ibmvfc_fcp_rsp_data data;
}__attribute__((packed, aligned (8)));

struct cpu_suspend_ctx {
	u64 ctx_regs[NR_CTX_REGS];
	u64 sp;
} __aligned(16);
```

- 内建函数

```c
__builtin_constant_p
__builtin_expect
```

- asmlinkage

- UL

  - 1：表示有符号整型数字 1
  - 1UL：表示无符号长整型数字 1
