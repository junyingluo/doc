### 四元数

- 定义：表示两个向量的比值 $q=\dfrac{\vec{b}}{\vec{a}} $

  <img src="assets/2.4 四元数/quaternion_fig01.png" width="30%" height="30%" />

- 设 $\hat{a}, \hat{b}, \hat{c}$ 为单位向量，则 $q=\dfrac{\vec{b}}{\vec{a}}=\dfrac{B\hat{b}}{A\hat{a}}=\dfrac{B}{A}(\cos\theta + \dfrac{\hat{c}}{\hat{a}} \sin\theta) $

  <img src="assets/2.4 四元数/quaternion_fig04.png" width="40%" height="40%" />

- 设 $\hat{u}=\dfrac{\hat{c}}{\hat{a}}$，其为垂直于旋转平面的单位向量，其方向按右手法则（四指由 $\hat{a}$ 指向 $\hat{c}$，拇指方向为正方向）

  <img src="assets/2.4 四元数/quaternion_fig05.png" width="40%" height="40%" />

### 特性

- 向量表示： $q=s(\cos\theta + \sin\theta \vec{u})$，其 $\vec{u}$ 为旋转轴

- 代数表示： $q=w+xi+yj+zk$

- 模：$|q|=\sqrt{w^2+x^2+y^2+z^2}$

- 轭：$q^*=w-xi-yj-zk$

- 逆：$qq^{-1}=1$

- 单位四元数：$|q|=1$
  - $q^{-1}=q^*$

### 旋转

- 设向量 $\vec{p}=(x,y,z)$ 绕单位向量 $\vec{r}$ 轴旋转 $\theta$，则 $p'=qpq^{-1}$，提取其虚部，即为旋转后的三维坐标。为什么不直接乘以$\cos \theta + \sin \theta \vec{r}$，因为会产生缩放。
  - $p=xi+yj+zk$

  - $q=\cos \dfrac{\theta}{2} + \sin \dfrac{\theta}{2} \vec{r}$
  - $q^{-1}=q^*=\cos \dfrac{\theta}{2} - \sin \dfrac{\theta}{2} \vec{r}$

  <img src="assets/2.4 四元数/gl_quaternion01.png" width="30%" height="30%" />

### 转换

- 欧拉角转四元数（绕 x 轴旋转 α，绕 y 轴旋转 β，绕 z 轴旋转 r）

  $$
  \begin{aligned}
  q = (\cos\frac{\gamma}{2} + \sin\frac{\gamma}{2}k)(\cos\frac{\beta}{2} + \sin\frac{\beta}{2}j)(\cos\frac{\alpha}{2} + \sin\frac{\alpha}{2}i)
  \end{aligned}
  $$

- 四元数转欧拉角

- 四元数 $q=a+bi+cj+dk$ 转旋转矩阵

  $$
  \begin{bmatrix}
  x' \\
  y' \\
  z' \\
  1
  \end{bmatrix}
  =
  \begin{bmatrix}
  1-2c^2-2d^2 & 2bc-2ad & 2ac+2bd & 0 \\
  2bc+2ad & 1-2b^2-2d^2 & 2cd-2ab & 0 \\
  2bd-2ac & 2ab+2cd & 1-2b^2-2c^2 & 0 \\
  0 & 0 & 0 & 1
  \end{bmatrix}
  \cdot
  \begin{bmatrix}
  x \\
  y \\
  z \\
  1
  \end{bmatrix}
  $$

- 旋转矩阵转四元数

### 参考

- http://www.songho.ca/opengl/gl_quaternion.html

- http://www.songho.ca/math/quaternion/quaternion.html
