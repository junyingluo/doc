### 相机变换

- 世界坐标系 $\Rightarrow$ 相机坐标系

* 设世界坐标系下的相机位于 $(a,b,c)$ 点，相机坐标系的基向量矩阵为 $M_{基}$，对于 $P$ 点，其在世界坐标系下坐标为 $\begin {bmatrix}x\\ y\\ z\end {bmatrix}$，在相机坐标系下坐标为 $\begin {bmatrix}x'\\ y'\\ z'\end {bmatrix}$，则有

$$
\begin {bmatrix}
1 & 0 & 0 & a \\
0 & 1 & 0 & b \\
0 & 0 & 1 & c \\
0 & 0 & 0 & 1
\end {bmatrix}
M_{基}
\begin {bmatrix}
x'\\ y'\\ z'\\ 1
\end {bmatrix}
=
\begin {bmatrix}
x\\ y\\ z\\ 1
\end {bmatrix}
\Rightarrow
\begin {bmatrix}
x'\\ y'\\ z'\\ 1
\end {bmatrix}
=
\begin {bmatrix}
x\\ y\\ z\\ 1
\end {bmatrix}
$$

- http://www.songho.ca/opengl/gl\_camera.html

### $M_{基}$

- 根据“朝向点”和“向上向量”，求 $M_{基}$
  - z 方向的基向量 (forword) ，即，“相机坐标”减去“朝向点坐标”，并归一化
  - x 方向的基向量 (left) ，利用 z 方向的单位向量和向上单位向量 {0,1,0} 的叉乘求得
  - y 方向的基向量 (up) ，利用 z 方向的单位向量和 x 方向的单位向量的叉乘求得

  $$
  M_{基} =
  \begin {bmatrix}
  l_x & u_x & f_x \\
  l_y & u_y & f_y \\
  l_z & u_z & f_z \\
  \end {bmatrix}
  $$

* 合并平移矩阵

  $$
  M_{view} = M_{平移} \cdot M_{基} =
  \begin {bmatrix}
  l_x & u_x & f_x & a \\
  l_y & u_y & f_y & b \\
  l_z & u_z & f_z & c \\
  0 & 0 & 0 & 1
  \end {bmatrix}
  $$

### Three

```js
lookAt ( eye, target, up ) {
  const te = this.elements;
  _z.subVectors ( eye, target ) ;
  _z.normalize ( ) ;
  _x.crossVectors ( up, _z ) ;
  _x.normalize ( ) ;
  _y.crossVectors ( _z, _x ) ;
  te [0 ] = _x.x; te [4 ] = _y.x; te [8 ] = _z.x;
  te [1 ] = _x.y; te [5 ] = _y.y; te [9 ] = _z.y;
  te [2 ] = _x.z; te [6 ] = _y.z; te [10 ] = _z.z;
  return this;
}
```

### 参考

- http://www.songho.ca/opengl/gl\_camera.html
- http://www.songho.ca/opengl/gl\_lookattoaxes.html
