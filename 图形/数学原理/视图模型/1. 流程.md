### 概念

- 设备空间，是 -1 到 1 之间的正方体，因此传给 Opengl 的点必须在 -1 到 1 之间
  - 设备坐标系 z 轴方向朝屏幕里，世界坐标系 z 轴方向屏幕外

  <img src="assets/1. 流程/gl_space.png" width="30%" height="30%" />

- 设备空间的 x 和 y 轴组成的平面会映射到 gl.viewport(x, y, w, h) 对应的区域

  ```js
  const canvas = document.getElementById("canvas");
  canvas.width = canvas.clientWidth * window.devicePixelRatio;
  canvas.height = canvas.clientHeight * window.devicePixelRatio;

  const gl = canvas.getContext("webgl");
  gl.viewport(0, 0, canvas.width, canvas.height);
  ```

* Opengl 是列向量，因此变换矩阵只能是“左乘”

* 几何变换作用于点，发生在顶点着色器之前

* 物体初始位于世界坐标系下的原点

### 变换流程

![alt text](<assets/1. 流程/gl_transform.png>)

- http://www.songho.ca/opengl/gl_transform.html

- 模型变换：物体坐标系 $\rightarrow$ 世界坐标系

  $$
  \begin{bmatrix}
  x_{model} \\ y_{model} \\ z_{model} \\ 1
  \end{bmatrix}
  =
  M_{model}
  \begin{bmatrix}
  x_{obj} \\ y_{obj} \\ z_{obj} \\ 1
  \end{bmatrix}
  $$
  - 平移：x 轴平移 a，y 轴平移 b，z 轴平移 z

    $$
    \begin{bmatrix}
    1 & 0 & 0 & a \\
    0 & 1 & 0 & b \\
    0 & 0 & 1 & c \\
    0 & 0 & 0 & 1
    \end{bmatrix}
    \begin{bmatrix}
    x \\ y \\ z \\ 1
    \end{bmatrix}
    =
    \begin{bmatrix}
    x+a \\ y+b \\ z+c \\ 1
    \end{bmatrix}
    $$

  - 缩放：x 轴缩放 a 倍，y 轴缩放 b 倍，z 轴缩放 z 倍

    $$
    \begin{bmatrix}
    a & 0 & 0 & 0 \\
    0 & b & 0 & 0 \\
    0 & 0 & c & 0 \\
    0 & 0 & 0 & 1
    \end{bmatrix}
    \begin{bmatrix}
    x \\ y \\ z \\ 1
    \end{bmatrix}
    =
    \begin{bmatrix}
    a\cdot x \\ b\cdot y \\ c\cdot z \\ 1
    \end{bmatrix}
    $$

  - 旋转

- 视图变换：世界坐标系 $\rightarrow$ 相机坐标系，又称，相机变换或眼变换

  $$
  \begin{bmatrix}
  x_{eye} \\ y_{eye} \\ z_{eye} \\ 1
  \end{bmatrix}
  =
  M_{view}
  \begin{bmatrix}
  x_{model} \\ y_{model} \\ z_{model} \\ 1
  \end{bmatrix}
  $$

- 投影变换：相机坐标系 $\rightarrow$ 设备坐标系，并进行裁减
