### ScreenSpaceEventHandler

<img src="assets/1. ScreenSpaceEventHandler/1.png" width="60%" height="60%" />

- 监听 canvas 鼠标事件
  - pointerdown: handlePointerDown
  - pointerup: handlePointerUp
  - pointermove: handlePointerMove
  - pointercancel: handlePointerUp

- \_primaryPosition 鼠标当前位置

* \_primaryStartPosition 鼠标按下时位置
* \_primaryPreviousPosition 鼠标上一次位置

### handlePointerDown

- 更新 \_primaryPosition、\_primaryStartPosition、\_primaryPreviousPosition

- getModifier 获取修饰键（modifier），即，SHIFT、CTRL、ALT

* 根据 event.button 生成 screenSpaceEventType，即，LEFT_DOWN，MIDDLE_DOWN，RIGHT_DOWN

* 根据 screenSpaceEventType 和 modifier 找到监听器，并将鼠标位置传给监听器

```js
function handlePointerDown(screenSpaceEventHandler, event) {
  event.target.setPointerCapture(event.pointerId);

  if (event.pointerType === "touch") {
    ......
  } else {
    handleMouseDown(screenSpaceEventHandler, event);
  }
}
```

### handlePointerUp

- 更新 \_primaryPosition

- 根据 event.button 生成 screenSpaceEventType，即，LEFT_DOWN，MIDDLE_DOWN，RIGHT_DOWN

* \_primaryPosition 和 \_primaryStartPosition 之间的距离过近，还会生成点击事件 LEFT_CLICK，LEFT_CLICK，LEFT_CLICK

- 根据 screenSpaceEventType 和 modifier 找到监听器，并将鼠标位置传给监听器

```js
function handlePointerUp(screenSpaceEventHandler, event) {
  if (event.pointerType === "touch") {
    ......
  } else {
    handleMouseUp(screenSpaceEventHandler, event);
  }
}
```

### handlePointerMove

- 更新 \_primaryPosition

- 根据 MOUSE_MOVE 和 modifier 找到监听器，并将鼠标起始和结束位置传给监听器
  - 起始位置为 \_primaryPreviousPosition
  - 结束位置为 \_primaryPosition

* 将 \_primaryPreviousPosition 设置为 \_primaryPosition

```js
function handlePointerMove(screenSpaceEventHandler, event) {
  if (event.pointerType === "touch") {
    ......
  } else {
    handleMouseMove(screenSpaceEventHandler, event);
  }
}
```
